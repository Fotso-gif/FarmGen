{% extends "client/layout/main.html" %}
{% load  static  %}
{% block title %} Accueil {% endblock %}
{% block css %}
<style>
body{
    width:100%;
    overflow-x:hidden !important;
}
    /* Hero Section */
        .hero-section {
            background: linear-gradient(rgba(34, 139, 34, 0.8), rgba(34, 139, 34, 0.6)), url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1932&q=80');
            background-size: cover;
            background-position: center;
            min-height: 80vh;
            display: flex;
            align-items: center;
            color: white;
            padding: 100px 0;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            max-width: 600px;
        }
        
        .hero-badge {
            display: inline-block;
            background-color: rgba(255, 215, 0, 0.9);
            color: var(--text-dark);
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 600;
            margin-bottom: 2rem;
        }
        
        /* Section Styles */
        .section {
            padding: 80px 0;
        }
        
        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--primary-green);
            text-align: center;
        }
        
        .section-subtitle {
            display: block;
            color: var(--primary-yellow);
            font-weight: 500;
            margin-bottom: 1rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .section-description {
            font-size: 1.1rem;
            color: var(--text-light);
            text-align: center;
            max-width: 700px;
            margin: 0 auto 3rem;
        }
        
        /* Value Proposition */
        .value-card {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            height: 100%;
        }
        
        .value-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .value-icon {
            width: 80px;
            height: 80px;
            background-color: rgba(34, 139, 34, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: var(--primary-green);
        }
        
        .value-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--text-dark);
        }
        .value-card p {
            font-family: var(--primary-font);
            margin-bottom: 15px;
            color: var(--text-dark);
        }
        
        /* Product Cards */
        .product-card {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            background-color: white;
            height: 100%;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .product-image {
            height: 200px;
            overflow: hidden;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        
        .product-info {
            padding: 20px;
        }
        
        .product-category {
            color: var(--primary-yellow);
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .product-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        
        .product-description {
            height:7rem;
            overflow-y:Scroll;
            scrollbar-width: none;
            color: var(--text-light);
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .product-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-green);
            margin-bottom: 15px;
        }
        
        .product-seller {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .seller-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: var(--primary-green);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        /* Video Section */
        .video-section {
            background-color: rgba(34, 139, 34, 0.05);
            position: relative;
        }
        
        .video-container {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            max-width: 800px;
            margin: 0 auto;
        }

        .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    grid-column: 1 / -1;
  }

  .empty-state i {
    font-size: 4rem;
    color: var(--light-gray);
    margin-bottom: 1.5rem;
  }

  .empty-state h3 {
    font-size: 1.8rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-dark);
  }

  .empty-state p {
    color: var(--text-dark);
    max-width: 500px;
    margin: 0 auto 2rem;
    line-height: 1.6;
  }
        
        /* Stats Section */
        .stats-section {
            background: linear-gradient(rgba(34, 139, 34, 0.9), rgba(34, 139, 34, 0.8)), url('https://images.unsplash.com/photo-1625246333195-78d9c38ad449?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
        }
        
        .stat-card {
            padding: 30px;
        }
        
        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--primary-yellow);
        }
        
        .stat-label {
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Blog Section */
        .blog-card {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            background-color: white;
            height: 100%;
        }
        
        .blog-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .blog-image {
            height: 200px;
            overflow: hidden;
        }
        
        .blog-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }
        
        .blog-card:hover .blog-image img {
            transform: scale(1.05);
        }
        
        .blog-info {
            padding: 20px;
        }
        
        .blog-category {
            color: var(--primary-yellow);
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .blog-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        
        .blog-excerpt {
            color: var(--text-light);
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .blog-meta {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .blog-meta i {
            margin-right: 5px;
            color: var(--primary-green);
        }

        /* Carousel Styles - Compatible avec le design existant */
.blog-carousel-container {
    position: relative;
    overflow: hidden;
}

.carousel-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 1rem;
}

.carousel-indicators {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    flex-grow: 1;
}

.carousel-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #dee2e6;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.carousel-indicator.active {
    background-color: var(--primary-green);
    transform: scale(1.2);
}

.carousel-prev,
.carousel-next {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
}

.carousel-wrapper {
    overflow: hidden;
    position: relative;
}

.carousel-track {
    display: flex;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    gap: 2rem;
    padding: 0.5rem 0;
}

.carousel-item {
    flex: 0 0 calc(33.333% - 1.33rem); /* 3 colonnes sur desktop */
    min-width: calc(33.333% - 1.33rem);
    transition: all 0.3s ease;
}

.carousel-item:hover {
    transform: translateY(-5px);
}

.carousel-dots-mobile {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
}

.carousel-dot-mobile {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #dee2e6;
    border: none;
    cursor: pointer;
}

.carousel-dot-mobile.active {
    background-color: var(--primary-green);
}

/* Responsive */
@media (max-width: 992px) {
    .carousel-item {
        flex: 0 0 calc(50% - 1rem); /* 2 colonnes sur tablette */
        min-width: calc(50% - 1rem);
    }
}

@media (max-width: 768px) {
    .carousel-item {
        flex: 0 0 100%; /* 1 colonne sur mobile */
        min-width: 100%;
    }
    
    .carousel-nav {
        padding: 0;
    }
    
    .carousel-indicators {
        display: none; /* Cacher les indicateurs sur mobile */
    }
}

/* Animation pour le chargement */
.loading-state {
    width: 100%;
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

/* Filtres */
.blog-filters {
    opacity: 0;
    animation: fadeIn 0.5s ease forwards;
    animation-delay: 0.3s;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.filter-btn.active {
    background-color: var(--primary-green);
    color: white;
    border-color: var(--primary-green);
}
        
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .section {
                padding: 60px 0;
            }
        }
    
</style>
{% endblock %}
{% block main %}
<!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <span class="hero-badge">
                        <i class="fas fa-leaf me-2"></i>La première marketplace agricole du Cameroun
                    </span>
                    <h1 class="hero-title">FarmGen: Votre marché agricole en ligne</h1>
                    <p class="hero-subtitle">Connectons directement agriculteurs et consommateurs pour une alimentation saine, traçable et de qualité.</p>
                    <div class="d-flex flex-wrap gap-3">
                        <a href="{% url 'marketplace' %}" class="btn btn-primary">Explorer le marché</a>
                        {% if not user.is_authenticated %}
                            <a href="{% url 'register_view' %}" class="btn btn-outline" style="background-color: white; color: var(--primary-green);">Devenir vendeur/client</a>
                        {% else %}
                            <a href="{% url 'profile' %}" class="btn btn-outline" style="background-color: white; color: var(--primary-green);">Gerer votre compte</a>
                        {% endif %}

                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Value Proposition -->
    <section class="section">
        <div class="container">
            <span class="section-subtitle">Pourquoi choisir FarmGen</span>
            <h2 class="section-title">Votre plateforme agricole complète</h2>
            <p class="section-description">FarmGen révolutionne l'achat et la vente de produits agricoles au Cameroun avec des outils modernes et efficaces.</p>
            
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="value-card">
                        <div class="value-icon">
                            <i class="fas fa-tractor"></i>
                        </div>
                        <h3>Producteurs locaux</h3>
                        <p>Connectez-vous directement avec des agriculteurs et coopératives locales pour des produits frais et authentiques.</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="value-card">
                        <div class="value-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3>Traçabilité complète</h3>
                        <p>Suivez l'origine de vos produits, des semences à votre assiette, pour une consommation en toute confiance.</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="value-card">
                        <div class="value-icon">
                            <i class="fas fa-shopping-basket"></i>
                        </div>
                        <h3>Marketplace intuitive</h3>
                        <p>Une plateforme simple d'utilisation pour découvrir, comparer et acheter les meilleurs produits agricoles.</p>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="value-card">
                        <div class="value-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3>Paiements sécurisés</h3>
                        <p>Payez facilement via Mobile Money, Orange Money ou cartes bancaires avec des transactions sécurisées.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="section bg-light" id="marketplace">
        <div class="container">
            <span class="section-subtitle">Découvrez nos Boutiques</span>
            <h2 class="section-title">Boutiques phares du marché</h2>
            <p class="section-description">Une sélection des meilleurs Boutiques agricoles disponibles sur notre marketplace.</p>
            {% if shops %}
            <div class="row g-4">
            {% for shop in shops %}
                <div class="col-md-6 col-lg-3">
                    <div class="product-card">
                        <div class="product-image">
                            <img src="{{ shop.couverture.url }}" alt="{{shop.title}}">
                        </div>
                        <div class="product-info">
                            <div class="product-category">{{shop.type_shop}}</div>
                            <h3 class="product-name">{{shop.title}}</h3>
                            <p class="product-description">{{shop.description}}</p>
                            
                            <div class="product-seller">
                                <div class="seller-avatar">{{ shop.user.first_name|first|upper }}{{ shop.user.last_name|first|upper }}</div>
                            </div>
                            <a href="{% url 'shop' shop.id %}" class="btn btn-primary w-100">Visiter la boutique</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-store-slash"></i>
                    <h3>Aucune boutique disponible</h3>
                    <p>Il n'y a actuellement aucune boutique dans la marketplace.</p>
                </div>
            {% endif %}
            
            <div class="text-center mt-5">
                <a href="{% url 'marketplace' %}" class="btn btn-primary">Voir tous les boutiques</a>
            </div>
        </div>
    </section>

    <!-- Video Section -->
    <section class="section video-section">
        <div class="container">
            <span class="section-subtitle">Découvrez FarmGen</span>
            <h2 class="section-title">Comment fonctionne notre plateforme</h2>
            <p class="section-description">Regardez notre vidéo de présentation pour comprendre comment FarmGen révolutionne le marché agricole camerounais.</p>
            
            <div class="video-container">
                <div class="ratio ratio-16x9">
                    <iframe src="https://www.youtube.com/embed/TNugLK3Ffgs" title="Présentation FarmGen" allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="section stats-section">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-number" data-count="500">0</div>
                        <div class="stat-label">Agriculteurs</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-number" data-count="2500">0</div>
                        <div class="stat-label">Clients satisfaits</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-number" data-count="150">0</div>
                        <div class="stat-label">Produits différents</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-card">
                        <div class="stat-number" data-count="10000">0</div>
                        <div class="stat-label">Transactions</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Blog Section avec carousel -->
<section class="section" id="blog">
    <div class="container">
        <span class="section-subtitle">Conseils et actualités</span>
        <h2 class="section-title">Blog agricole FarmGen</h2>
        <p class="section-description">Découvrez nos articles, podcasts et affiches sur l'agriculture, les techniques modernes et les tendances du marché.</p>
        
        <!-- Filtres (optionnel) -->
        <div class="blog-filters mb-4" id="blog-filters" style="display: none;">
            <div class="d-flex flex-wrap gap-2 justify-content-center">
                <button class="btn btn-sm btn-outline-primary filter-btn active" data-filter="all">Tous</button>
                <button class="btn btn-sm btn-outline-primary filter-btn" data-filter="article">Articles</button>
                <button class="btn btn-sm btn-outline-primary filter-btn" data-filter="affiche">Affiches</button>
                <button class="btn btn-sm btn-outline-primary filter-btn" data-filter="podcast">Podcasts</button>
            </div>
        </div>
        
        <!-- Carousel Container -->
        <div class="blog-carousel-container">
            <!-- Navigation -->
            <div class="carousel-nav mb-4">
                <button class="carousel-prev btn btn-outline-primary" id="carousel-prev">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="carousel-indicators" id="carousel-indicators"></div>
                <button class="carousel-next btn btn-outline-primary" id="carousel-next">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- Carousel Track -->
            <div class="carousel-wrapper">
                <div class="carousel-track" id="carousel-track">
                    <!-- Les articles seront chargés ici par AJAX -->
                    <div class="loading-state text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Chargement...</span>
                        </div>
                        <p class="mt-3">Chargement des articles...</p>
                    </div>
                </div>
            </div>
            
            <!-- Pagination dots (mobile) -->
            <div class="carousel-dots-mobile d-md-none mt-3" id="carousel-dots-mobile"></div>
        </div>
        
        <div class="text-center mt-5">
            <a href="{% url 'blog' %}" class="btn btn-primary">Voir tous les articles</a>
        </div>
    </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const carouselTrack = document.getElementById('carousel-track');
    const prevBtn = document.getElementById('carousel-prev');
    const nextBtn = document.getElementById('carousel-next');
    const indicatorsContainer = document.getElementById('carousel-indicators');
    const dotsMobileContainer = document.getElementById('carousel-dots-mobile');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const filtersContainer = document.getElementById('blog-filters');
    
    let articles = [];
    let currentFilter = 'all';
    let currentPosition = 0;
    let itemsPerView = 3; // Par défaut 3 sur desktop
    let totalItems = 0;
    let maxPosition = 0;
    
    // Détecter le nombre d'éléments par vue selon la largeur d'écran
    function updateItemsPerView() {
        const width = window.innerWidth;
        if (width >= 992) {
            itemsPerView = 3; // Desktop
        } else if (width >= 768) {
            itemsPerView = 2; // Tablet
        } else {
            itemsPerView = 1; // Mobile
        }
        updateCarousel();
    }
    
    // Charger les articles depuis l'API
    function loadArticles(filter = 'all') {
        // Afficher l'état de chargement
        carouselTrack.innerHTML = `
            <div class="loading-state">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="mt-3">Chargement des articles...</p>
            </div>
        `;
        
        // Construire l'URL avec les paramètres
        let url = '/blog/api/carousel/?limit=12';
        if (filter !== 'all') {
            url += `&category=${filter}`;
        }
        
        // Récupérer les données
        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    articles = data.articles;
                    totalItems = articles.length;
                    maxPosition = Math.max(0, Math.ceil(totalItems / itemsPerView) - 1);
                    
                    // Afficher les filtres si on a des articles
                    if (totalItems > 0 && filtersContainer) {
                        filtersContainer.style.display = 'block';
                    }
                    
                    renderArticles();
                    createIndicators();
                    updateCarousel();
                } else {
                    showError('Erreur lors du chargement des articles');
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                showError('Impossible de charger les articles. Veuillez réessayer.');
            });
    }
    
    // Afficher les articles dans le carousel
    function renderArticles() {
        if (articles.length === 0) {
            carouselTrack.innerHTML = `
                <div class="text-center py-5 w-100">
                    <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                    <h4>Aucun article disponible</h4>
                    <p class="text-muted">Aucun article trouvé pour cette catégorie.</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        articles.forEach((article, index) => {
            // Formater la date en français
            const date = new Date(article.date_published);
            const formattedDate = date.toLocaleDateString('fr-FR', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            html += `
                <div class="col-md-6 col-lg-4 carousel-item" style="display:block !important;" data-index="${index}">
                    <div class="blog-card">
                        <div class="blog-image">
                            <img src="${article.image_url}" 
                                 alt="${article.title}" 
                                 loading="lazy"
                                 onerror="this.src='https://images.unsplash.com/photo-1625246333195-78d9c38ad449?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80'">
                            <div class="blog-type-badge">
                                <i class="${article.type_icon}"></i>
                                ${article.category}
                            </div>
                        </div>
                        <div class="blog-info">
                            <div class="blog-category">${article.category}</div>
                            <h3 class="blog-title">
                                <a href="/blog/article/${article.id}/" class="text-decoration-none text-dark">
                                    ${article.title}
                                </a>
                            </h3>
                            <p class="blog-excerpt">${article.excerpt}</p>
                            <div class="blog-meta">
                                <span><i class="far fa-calendar"></i> ${formattedDate}</span>
                                <span class="ms-3"><i class="far fa-clock"></i> ${article.reading_time}</span>
                                ${article.shop_title !== 'FarmGen' ? `
                                    <span class="ms-3"><i class="fas fa-store"></i> ${article.shop_title}</span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        carouselTrack.innerHTML = html;
        carouselTrack.style.display = 'flex';
    }
    
    // Créer les indicateurs de navigation
    function createIndicators() {
        const totalSlides = Math.ceil(totalItems / itemsPerView);
        
        // Indicateurs desktop
        indicatorsContainer.innerHTML = '';
        for (let i = 0; i < totalSlides; i++) {
            const indicator = document.createElement('button');
            indicator.className = `carousel-indicator ${i === 0 ? 'active' : ''}`;
            indicator.setAttribute('aria-label', `Slide ${i + 1}`);
            indicator.addEventListener('click', () => goToSlide(i));
            indicatorsContainer.appendChild(indicator);
        }
        
        // Points mobile
        dotsMobileContainer.innerHTML = '';
        for (let i = 0; i < totalItems; i++) {
            const dot = document.createElement('button');
            dot.className = `carousel-dot-mobile ${i < itemsPerView ? 'active' : ''}`;
            dot.addEventListener('click', () => goToItem(i));
            dotsMobileContainer.appendChild(dot);
        }
    }
    
    // Mettre à jour la position du carousel
    function updateCarousel() {
        // Calculer la nouvelle position maximale
        maxPosition = Math.max(0, Math.ceil(totalItems / itemsPerView) - 1);
        
        // Limiter la position courante
        if (currentPosition > maxPosition) {
            currentPosition = maxPosition;
        }
        
        // Calculer le décalage
        const offset = -(currentPosition * 100);
        carouselTrack.style.transform = `translateX(${offset}%)`;
        
        // Mettre à jour les indicateurs
        updateIndicators();
        
        // Mettre à jour les boutons de navigation
        updateNavButtons();
    }
    
    // Mettre à jour les indicateurs actifs
    function updateIndicators() {
        const indicators = document.querySelectorAll('.carousel-indicator');
        const dots = document.querySelectorAll('.carousel-dot-mobile');
        
        // Indicateurs desktop
        indicators.forEach((indicator, index) => {
            indicator.classList.toggle('active', index === currentPosition);
        });
        
        // Points mobile
        const startIndex = currentPosition * itemsPerView;
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index >= startIndex && index < startIndex + itemsPerView);
        });
    }
    
    // Mettre à jour l'état des boutons de navigation
    function updateNavButtons() {
        prevBtn.disabled = currentPosition === 0;
        nextBtn.disabled = currentPosition === maxPosition;
        
        // Ajouter des classes pour le style désactivé
        if (prevBtn.disabled) {
            prevBtn.classList.add('disabled');
        } else {
            prevBtn.classList.remove('disabled');
        }
        
        if (nextBtn.disabled) {
            nextBtn.classList.add('disabled');
        } else {
            nextBtn.classList.remove('disabled');
        }
    }
    
    // Aller à un slide spécifique
    function goToSlide(slideIndex) {
        currentPosition = Math.max(0, Math.min(slideIndex, maxPosition));
        updateCarousel();
    }
    
    // Aller à un élément spécifique (mobile)
    function goToItem(itemIndex) {
        currentPosition = Math.floor(itemIndex / itemsPerView);
        updateCarousel();
    }
    
    // Slide suivant
    function nextSlide() {
        if (currentPosition < maxPosition) {
            currentPosition++;
            updateCarousel();
        }
    }
    
    // Slide précédent
    function prevSlide() {
        if (currentPosition > 0) {
            currentPosition--;
            updateCarousel();
        }
    }
    
    // Filtrer les articles
    function filterArticles(filter) {
        currentFilter = filter;
        currentPosition = 0; // Réinitialiser la position
        
        // Mettre à jour les boutons de filtre
        filterButtons.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.filter === filter);
        });
        
        // Recharger les articles avec le filtre
        loadArticles(filter);
    }
    
    // Afficher une erreur
    function showError(message) {
        carouselTrack.innerHTML = `
            <div class="text-center py-5 w-100">
                <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                <h4>Erreur de chargement</h4>
                <p class="text-muted">${message}</p>
                <button class="btn btn-primary mt-3" onclick="loadArticles('${currentFilter}')">
                    <i class="fas fa-redo"></i> Réessayer
                </button>
            </div>
        `;
    }
    
    // Initialisation
    function init() {
        // Charger les articles initiaux
        loadArticles();
        
        // Événements de navigation
        prevBtn.addEventListener('click', prevSlide);
        nextBtn.addEventListener('click', nextSlide);
        
        // Événements des filtres
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                filterArticles(btn.dataset.filter);
            });
        });
        
        // Redimensionnement de la fenêtre
        window.addEventListener('resize', () => {
            updateItemsPerView();
        });
        
        // Navigation au clavier
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                prevSlide();
            } else if (e.key === 'ArrowRight') {
                nextSlide();
            }
        });
        
        // Swipe sur mobile
        let touchStartX = 0;
        let touchEndX = 0;
        
        carouselTrack.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        carouselTrack.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // Swipe gauche = suivant
                    nextSlide();
                } else {
                    // Swipe droite = précédent
                    prevSlide();
                }
            }
        }
        
        // Auto-rotation (optionnel)
        let autoRotateInterval;
        
        function startAutoRotate() {
            if (autoRotateInterval) clearInterval(autoRotateInterval);
            autoRotateInterval = setInterval(() => {
                if (currentPosition === maxPosition) {
                    goToSlide(0);
                } else {
                    nextSlide();
                }
            }, 5000); // Change toutes les 5 secondes
        }
        
        function stopAutoRotate() {
            if (autoRotateInterval) {
                clearInterval(autoRotateInterval);
                autoRotateInterval = null;
            }
        }
        
        // Démarrer l'auto-rotation
        startAutoRotate();
        
        // Arrêter l'auto-rotation au hover
        carouselTrack.addEventListener('mouseenter', stopAutoRotate);
        carouselTrack.addEventListener('mouseleave', startAutoRotate);
        carouselTrack.addEventListener('touchstart', stopAutoRotate);
        carouselTrack.addEventListener('touchend', () => {
            setTimeout(startAutoRotate, 3000);
        });
        
        // Initialiser le nombre d'éléments par vue
        updateItemsPerView();
    }
    
    // Démarrer l'initialisation
    init();
});
</script>
{% endblock %}