{% extends "client/layout/main.html" %}
{% load static %}
{% load humanize %}

{% block css %}
<style>
  /* Variables CSS adaptées à FarmGen */
  :root {
    --primary-green: #2ecc71;
    --dark-green: #27ae60;
    --forest-green: #1e5631;
    --light-green: #a4de02;
    --earth-brown: #8B4513;
    --white: #ffffff;
    --light-gray: #f8f9fa;
    --text-dark: #2c3e50;
    --card-bg: #ffffff;
    --border-color: #e0e0e0;
    --darker-bg: #f5f5f5;
  }

  /* Hero Section Blog */
  .blog-hero {
    background: linear-gradient(135deg, var(--forest-green) 0%, var(--dark-green) 100%);
    padding: 10rem 2rem 6rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .blog-hero::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80") center/cover no-repeat;
    opacity: 0.15;
    z-index: 1;
  }

  .blog-hero-content {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    z-index: 2;
  }

  .blog-hero h1 {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 1.5rem;
    color: var(--white);
  }

  .blog-hero p {
    font-size: 1.3rem;
    color: var(--light-gray);
    max-width: 800px;
    margin: 0 auto 3rem;
    line-height: 1.6;
  }

  /* Breadcrumb */
  .breadcrumb {
    background: linear-gradient(135deg, var(--forest-green) 0%, var(--dark-green) 100%);
    width:100%;
    margin: 0 auto 2rem;
    padding: 0 2rem;
    display: flex;
    align-items: center;
    font-size: 0.9rem;
    color: var(--light-gray);
  }

  .breadcrumb a {
    color: var(--white);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .breadcrumb a:hover {
    color: var(--light-green);
  }

  .breadcrumb span {
    margin: 0 0.5rem;
  }

  /* Blog Layout */
  .blog-section {
    padding: 6rem 2rem;
    background: var(--light-gray);
  }

  .blog-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 4rem;
  }

  /* Featured Post */
  .featured-post {
    margin-bottom: 5rem;
    grid-column: 1 / -1;
  }

  .featured-post-card {
    background: var(--card-bg);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.4s ease;
    border: 1px solid var(--border-color);
    display: grid;
    grid-template-columns: 1fr 1fr;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    opacity: 0;
    transform: translateY(30px);
  }

  .featured-post-card.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .featured-post-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    border-color: var(--primary-green);
  }

  .featured-post-image {
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  .featured-post-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .featured-post-card:hover .featured-post-image img {
    transform: scale(1.05);
  }

  .featured-post-badge {
    position: absolute;
    top: 20px;
    left: 20px;
    background: var(--primary-green);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    z-index: 2;
  }

  .featured-post-content {
    padding: 3rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .post-meta {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: var(--text-dark);
    opacity: 0.8;
  }

  .post-author {
    display: flex;
    align-items: center;
    margin-right: 1.5rem;
  }

  .author-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    overflow: hidden;
    margin-right: 0.5rem;
    border: 2px solid var(--primary-green);
  }

  .author-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .post-date {
    display: flex;
    align-items: center;
  }

  .post-date i {
    margin-right: 0.5rem;
    color: var(--primary-green);
  }

  .featured-post-content h2 {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    line-height: 1.3;
    color: var(--text-dark);
  }

  .featured-post-content h2 a {
    color: var(--text-dark);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .featured-post-content h2 a:hover {
    color: var(--primary-green);
  }

  .featured-post-content p {
    color: var(--text-dark);
    line-height: 1.6;
    margin-bottom: 2rem;
    opacity: 0.8;
  }

  .post-tags {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 2rem;
  }

  .post-tag {
    background: rgba(46, 204, 113, 0.1);
    color: var(--primary-green);
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
    transition: all 0.3s ease;
  }

  .post-tag:hover {
    background: var(--primary-green);
    color: white;
    cursor: pointer;
  }

  .read-more {
    color: var(--primary-green);
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    transition: all 0.3s ease;
  }

  .read-more i {
    margin-left: 0.5rem;
    transition: transform 0.3s ease;
  }

  .read-more:hover {
    color: var(--dark-green);
  }

  .read-more:hover i {
    transform: translateX(5px);
  }

  /* Posts Grid */
  .posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2.5rem;
  }

  .post-card {
    background: var(--card-bg);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.4s ease;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    opacity: 0;
    transform: translateY(30px);
  }

  .post-card.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .post-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    border-color: var(--primary-green);
  }

  .post-card-image {
    height: 200px;
    position: relative;
    overflow: hidden;
  }

  .post-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .post-card:hover .post-card-image img {
    transform: scale(1.05);
  }

  .post-card-content {
    padding: 2rem;
  }

  .post-card-content h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    line-height: 1.3;
    color: var(--text-dark);
  }

  .post-card-content h3 a {
    color: var(--text-dark);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .post-card-content h3 a:hover {
    color: var(--primary-green);
  }

  .post-card-content p {
    color: var(--text-dark);
    line-height: 1.6;
    margin-bottom: 1.5rem;
    opacity: 0.8;
  }

  /* Sidebar */
  .sidebar {
    position: sticky;
    top: 120px;
    height: fit-content;
  }

  .sidebar-widget {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2.5rem;
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .sidebar-widget h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--primary-green);
    color: var(--text-dark);
  }

  /* About Widget */
  .about-widget p {
    color: var(--text-dark);
    line-height: 1.6;
    margin-bottom: 1.5rem;
    opacity: 0.8;
  }

  .social-links {
    display: flex;
    gap: 1rem;
  }

  .social-links a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--light-gray);
    color: var(--text-dark);
    transition: all 0.3s ease;
  }

  .social-links a:hover {
    background: var(--primary-green);
    color: white;
    transform: translateY(-3px);
  }

  /* Categories Widget */
  .categories-list {
    list-style: none;
  }

  .categories-list li {
    padding: 0.8rem 0;
    border-bottom: 1px solid var(--border-color);
  }

  .categories-list li:last-child {
    border-bottom: none;
  }

  .categories-list a {
    display: flex;
    justify-content: space-between;
    color: var(--text-dark);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .categories-list a:hover {
    color: var(--primary-green);
  }

  .category-count {
    background: var(--light-gray);
    color: var(--text-dark);
    padding: 0.2rem 0.6rem;
    border-radius: 20px;
    font-size: 0.8rem;
  }

  /* Recent Posts Widget */
  .recent-posts-list {
    list-style: none;
  }

  .recent-post {
    display: flex;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-color);
  }

  .recent-post:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
  }

  .recent-post-image {
    width: 80px;
    height: 80px;
    border-radius: 8px;
    overflow: hidden;
    margin-right: 1rem;
    flex-shrink: 0;
  }

  .recent-post-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .recent-post-content h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    line-height: 1.3;
  }

  .recent-post-content h4 a {
    color: var(--text-dark);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .recent-post-content h4 a:hover {
    color: var(--primary-green);
  }

  .recent-post-date {
    font-size: 0.8rem;
    color: var(--text-dark);
    opacity: 0.7;
    display: flex;
    align-items: center;
  }

  .recent-post-date i {
    margin-right: 0.3rem;
    color: var(--primary-green);
  }

  /* Tags Widget */
  .tags-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag {
    background: rgba(46, 204, 113, 0.1);
    color: var(--primary-green);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .tag:hover {
    background: var(--primary-green);
    color: white;
    transform: translateY(-2px);
  }

  .tag.active {
    background: var(--primary-green);
    color: white;
  }

  /* Newsletter Widget */
  .newsletter-form {
    margin-top: 1.5rem;
  }

  .newsletter-form input {
    width: 100%;
    padding: 1rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--light-gray);
    color: var(--text-dark);
    margin-bottom: 1rem;
    font-size: 1rem;
  }

  .newsletter-form input:focus {
    outline: none;
    border-color: var(--primary-green);
  }

  .newsletter-form button {
    width: 100%;
    padding: 8px 20px;
            border-radius: 30px;
    border: none;
    background: var(--primary-green);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .newsletter-form button:hover {
    background: var(--dark-green);
    transform: translateY(-2px);
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    margin-top: 5rem;
    grid-column: 1 / -1;
  }

  .pagination-list {
    display: flex;
    list-style: none;
    gap: 0.5rem;
  }

  .pagination-item a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 45px;
    height: 45px;
    border-radius: 8px;
    background: var(--card-bg);
    color: var(--text-dark);
    text-decoration: none;
    transition: all 0.3s ease;
    border: 1px solid var(--border-color);
  }

  .pagination-item a:hover,
  .pagination-item.active a {
    background: var(--primary-green);
    border-color: var(--primary-green);
    color: white;
    transform: translateY(-2px);
  }

  /* CTA Section */
  .blog-cta {
    padding: 6rem 2rem;
    background: linear-gradient(135deg, var(--forest-green) 0%, var(--dark-green) 100%);
    text-align: center;
    color: white;
    grid-column: 1 / -1;
  }

  .blog-cta-container {
    max-width: 800px;
    margin: 0 auto;
  }

  .blog-cta h2 {
    font-size: 2.8rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
  }

  .blog-cta p {
    font-size: 1.2rem;
    margin-bottom: 2.5rem;
    opacity: 0.9;
  }

  .cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .btn-light {
    background: white;
    color: var(--primary-green);
    padding: 8px 20px;
            border-radius: 30px;
    border: none;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
  }

  .btn-light:hover {
    background: rgba(255, 255, 255, 0.9);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  }

  .btn-outline-light {
    background: transparent;
    color: white;
    padding: 8px 20px;
            border-radius: 30px;
    border: 2px solid white;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
  }

  .btn-outline-light:hover {
    background: white;
    color: var(--primary-green);
    transform: translateY(-2px);
  }

  /* Filter Section */
  .blog-filters {
    margin-bottom: 3rem;
    grid-column: 1 / -1;
  }

  .filters-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  }

  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .filter-group label {
    font-weight: 600;
    color: var(--text-dark);
    margin-right: 0.5rem;
  }

  .filter-select {
    padding: 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--light-gray);
    color: var(--text-dark);
    cursor: pointer;
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--primary-green);
  }

  .clear-filters {
    background: var(--light-gray);
    color: var(--text-dark);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .clear-filters:hover {
    background: var(--primary-green);
    color: white;
  }

  /* Responsive Design */
  @media (max-width: 992px) {
    .blog-container {
      grid-template-columns: 1fr;
      gap: 3rem;
    }
    
    .sidebar {
      position: static;
      order: 2;
    }
    
    .posts-grid {
      order: 1;
    }
    
    .featured-post-card {
      grid-template-columns: 1fr;
    }
    
    .featured-post-image {
      height: 300px;
    }
  }

  @media (max-width: 768px) {
    .blog-hero {
      padding: 8rem 1.5rem 4rem;
    }
    
    .blog-hero h1 {
      font-size: 2.5rem;
    }
    
    .blog-hero p {
      font-size: 1.1rem;
    }
    
    .posts-grid {
      grid-template-columns: 1fr;
    }
    
    .cta-buttons {
      flex-direction: column;
      align-items: center;
    }
    
    .featured-post-content h2 {
      font-size: 1.8rem;
    }

    .filters-container {
      flex-direction: column;
      align-items: flex-start;
    }
  }

  /* Animation classes */
  .fade-in {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.6s ease;
  }

  .fade-in.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .delay-1 {
    transition-delay: 0.2s;
  }

  .delay-2 {
    transition-delay: 0.4s;
  }

  .delay-3 {
    transition-delay: 0.6s;
  }
</style>
<style>
  /* Variables CSS adaptées à FarmGen */
  :root {
    --primary-green: #2ecc71;
    --dark-green: #27ae60;
    --forest-green: #1e5631;
    --light-green: #a4de02;
    --earth-brown: #8B4513;
    --white: #ffffff;
    --light-gray: #f8f9fa;
    --text-dark: #2c3e50;
    --card-bg: #ffffff;
    --border-color: #e0e0e0;
    --darker-bg: #f5f5f5;
  }

  /* Hero Section Blog */
  .blog-hero {
    background: linear-gradient(135deg, var(--forest-green) 0%, var(--dark-green) 100%);
    padding: 10rem 2rem 6rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .blog-hero::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("{% static 'images/blog-hero-bg.jpg' %}") center/cover no-repeat;
    opacity: 0.15;
    z-index: 1;
  }

  .blog-hero-content {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    z-index: 2;
  }

  /* ... (keep all your existing CSS styles) ... */

  /* New styles for dynamic content */
  .shop-badge {
    background: var(--light-green);
    color: var(--forest-green);
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-block;
    margin-bottom: 1rem;
  }

  .favorite-btn {
    background: transparent;
    border: 2px solid var(--primary-green);
    color: var(--primary-green);
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .favorite-btn:hover,
  .favorite-btn.active {
    background: var(--primary-green);
    color: white;
  }

  .favorite-count {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    color: var(--text-dark);
    opacity: 0.7;
    font-size: 0.9rem;
  }

  .content-type-badge {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    z-index: 2;
  }

  .podcast-icon,
  .affiche-icon {
    margin-right: 0.3rem;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    grid-column: 1 / -1;
  }

  .empty-state i {
    font-size: 4rem;
    color: var(--border-color);
    margin-bottom: 1.5rem;
  }

  .empty-state h3 {
    color: var(--text-dark);
    margin-bottom: 1rem;
  }

  .empty-state p {
    color: var(--text-dark);
    opacity: 0.7;
    max-width: 500px;
    margin: 0 auto 2rem;
  }

  .loading-spinner {
    display: none;
    text-align: center;
    padding: 2rem;
    grid-column: 1 / -1;
  }

  .loading-spinner.active {
    display: block;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--border-color);
    border-top: 4px solid var(--primary-green);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Article card adjustments */
  .article-content-type {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.3rem 0.8rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-right: 0.5rem;
  }

  .type-article {
    background: rgba(52, 152, 219, 0.1);
    color: #3498db;
  }

  .type-affiche {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
  }

  .type-podcast {
    background: rgba(155, 89, 182, 0.1);
    color: #9b59b6;
  }
</style>
{% endblock %}

{% block main %}
<!-- Hero Section -->
<section class="blog-hero">
  <div class="blog-hero-content">
    <h1 class="fade-in">Blog FarmGen</h1>
    <p class="fade-in">Découvrez nos conseils agricoles, actualités et innovations pour optimiser votre production et développer votre activité agricole au Cameroun.</p>
    <div class="cta-buttons fade-in">
      <a href="#articles" class="btn-light">Explorer les articles</a>
      {% if user.is_authenticated and user.is_seller %}
      <a href="{% url 'seller_blog' %}" class="btn-outline-light">Publier un article</a>
      {% endif %}
    </div>
  </div>
</section>

<!-- Blog Section -->
<section class="blog-section" id="articles">
  <div class="blog-container">
    <!-- Filters Section -->
    <div class="blog-filters">
      <div class="filters-container">
        <div class="filter-group">
          <label>Boutique:</label>
          <select class="filter-select" id="shop-filter">
            <option value="all">Toutes les boutiques</option>
            {% for shop in shops %}
            <option value="{{ shop.id }}" {% if current_shop_filter == shop.id|stringformat:"i" %}selected{% endif %}>
              {{ shop.title }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="filter-group">
          <label>Type de contenu:</label>
          <select class="filter-select" id="type-filter">
            <option value="all">Tous les types</option>
            <option value="article" {% if current_type_filter == "article" %}selected{% endif %}>Articles</option>
            <option value="affiche" {% if current_type_filter == "affiche" %}selected{% endif %}>Affiches</option>
            <option value="podcast" {% if current_type_filter == "podcast" %}selected{% endif %}>Podcasts</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Tri par:</label>
          <select class="filter-select" id="sort-filter">
            <option value="recent">Plus récent</option>
            <option value="popular">Plus populaire</option>
            <option value="favoris">Plus de favoris</option>
          </select>
        </div>
        <button class="clear-filters" id="clear-filters">Effacer les filtres</button>
      </div>
    </div>

    <!-- Featured Post -->
    {% if articles %}
    {% with featured_article=articles.0 %}
    <div class="featured-post">
      <div class="featured-post-card fade-in">
        <div class="featured-post-image">
          {% if featured_article.image %}
          <img src="{{ featured_article.image.url }}" alt="{{ featured_article.titre }}">
          {% else %}
          <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" alt="{{ featured_article.titre }}">
          {% endif %}
          <div class="featured-post-badge">Article à la une</div>
          <div class="content-type-badge">
            {% if featured_article.type_contenu == 'article' %}
            <i class="fas fa-file-alt podcast-icon"></i>Article
            {% elif featured_article.type_contenu == 'affiche' %}
            <i class="fas fa-image affiche-icon"></i>Affiche
            {% else %}
            <i class="fas fa-podcast podcast-icon"></i>Podcast
            {% endif %}
          </div>
        </div>
        <div class="featured-post-content">
          {% if featured_article.shop %}
          <div class="shop-badge">{{ featured_article.shop.title }}</div>
          {% endif %}
          
          <div class="post-meta">
            <div class="post-author">
              {% if featured_article.shop.user.avatar %}
              <div class="author-avatar">
                <img src="{{ featured_article.shop.user.avatar.url }}" alt="{{ featured_article.shop.user.get_full_name }}">
              </div>
              {% else %}
              <div class="author-avatar">
                <img src="https://randomuser.me/api/portraits/men/65.jpg" alt="Auteur">
              </div>
              {% endif %}
              <span>{{ featured_article.shop.user.get_full_name|default:"Auteur FarmGen" }}</span>
            </div>
            <div class="post-date">
              <i class="far fa-calendar"></i>
              <span>{{ featured_article.date_publication|date:"d F Y" }}</span>
            </div>
          </div>
          
          <h2><a href="{% url 'article_detail' featured_article.id %}">{{ featured_article.titre }}</a></h2>
          
          <p>{{ featured_article.contenu|truncatewords:50|striptags }}</p>
          
          <div class="post-tags">
            <span class="article-content-type type-{{ featured_article.type_contenu }}">
              {% if featured_article.type_contenu == 'article' %}
              <i class="fas fa-file-alt"></i>Article
              {% elif featured_article.type_contenu == 'affiche' %}
              <i class="fas fa-image"></i>Affiche
              {% else %}
              <i class="fas fa-podcast"></i>Podcast
              {% endif %}
            </span>
            {% if featured_article.shop %}
            <span class="post-tag" data-tag="boutique-{{ featured_article.shop.id }}">{{ featured_article.shop.title }}</span>
            {% endif %}
          </div>
          
          <a href="{% url 'article_detail' featured_article.id %}" class="read-more">
            Lire l'article <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
    {% endwith %}
    {% endif %}

    <!-- Posts Grid -->
    <div class="posts-content">
      <!-- Loading Spinner -->
      <div class="loading-spinner" id="loading-spinner">
        <div class="spinner"></div>
        <p>Chargement des articles...</p>
      </div>

      <!-- Posts Container -->
      <div class="posts-grid" id="posts-container">
        {% for article in articles|slice:"1:" %}
        <div class="post-card fade-in" 
             data-shop="{{ article.shop.id|default:'' }}" 
             data-type="{{ article.type_contenu }}"
             data-date="{{ article.date_publication|date:'Y-m-d' }}">
          <div class="post-card-image">
            {% if article.image %}
            <img src="{{ article.image.url }}" alt="{{ article.titre }}">
            {% else %}
            <img src="https://images.unsplash.com/photo-1574326344267-5c1c5a4a2c7a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" alt="{{ article.titre }}">
            {% endif %}
            <div class="content-type-badge">
              {% if article.type_contenu == 'article' %}
              <i class="fas fa-file-alt"></i>Article
              {% elif article.type_contenu == 'affiche' %}
              <i class="fas fa-image"></i>Affiche
              {% else %}
              <i class="fas fa-podcast"></i>Podcast
              {% endif %}
            </div>
          </div>
          
          <div class="post-card-content">
            {% if article.shop %}
            <div class="shop-badge">{{ article.shop.title }}</div>
            {% endif %}
            
            <div class="post-meta">
              <div class="post-date">
                <i class="far fa-calendar"></i>
                <span>{{ article.date_publication|date:"d F Y" }}</span>
              </div>
              {% if article.shop %}
              <div class="favorite-count">
                <i class="fas fa-heart"></i>
                <span>{{ article.shop.favorited_by.count }}</span>
              </div>
              {% endif %}
            </div>
            
            <h3><a href="{% url 'article_detail' article.id %}">{{ article.titre }}</a></h3>
            
            <p>{{ article.contenu|truncatewords:30|striptags }}</p>
            
            <div class="post-tags">
              <span class="article-content-type type-{{ article.type_contenu }}">
                {% if article.type_contenu == 'article' %}
                <i class="fas fa-file-alt"></i>Article
                {% elif article.type_contenu == 'affiche' %}
                <i class="fas fa-image"></i>Affiche
                {% else %}
                <i class="fas fa-podcast"></i>Podcast
                {% endif %}
              </span>
            </div>
            
            <a href="{% url 'article_detail' article.id %}" class="read-more">
              Lire l'article <i class="fas fa-arrow-right"></i>
            </a>
          </div>
        </div>
        {% empty %}
        <div class="empty-state" style="grid-column: 1 / -1;">
          <i class="fas fa-newspaper"></i>
          <h3>Aucun article disponible</h3>
          <p>Il n'y a pas encore d'articles publiés sur le blog. Revenez bientôt !</p>
          {% if user.is_authenticated and user.is_seller %}
          <a href="{% url 'seller_blog' %}" class="btn-light">Publier le premier article</a>
          {% endif %}
        </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if articles.has_other_pages %}
      <div class="pagination">
        <ul class="pagination-list">
          {% if articles.has_previous %}
          <li class="pagination-item">
            <a href="?page={{ articles.previous_page_number }}{% if current_shop_filter %}&shop={{ current_shop_filter }}{% endif %}{% if current_type_filter %}&type={{ current_type_filter }}{% endif %}">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>
          {% endif %}
          
          {% for num in articles.paginator.page_range %}
            {% if articles.number == num %}
            <li class="pagination-item active"><a href="#">{{ num }}</a></li>
            {% elif num > articles.number|add:'-3' and num < articles.number|add:'3' %}
            <li class="pagination-item">
              <a href="?page={{ num }}{% if current_shop_filter %}&shop={{ current_shop_filter }}{% endif %}{% if current_type_filter %}&type={{ current_type_filter }}{% endif %}">
                {{ num }}
              </a>
            </li>
            {% endif %}
          {% endfor %}
          
          {% if articles.has_next %}
          <li class="pagination-item">
            <a href="?page={{ articles.next_page_number }}{% if current_shop_filter %}&shop={{ current_shop_filter }}{% endif %}{% if current_type_filter %}&type={{ current_type_filter }}{% endif %}">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
          {% endif %}
        </ul>
      </div>
      {% endif %}
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- About Widget -->
      <div class="sidebar-widget fade-in">
        <h3>À propos</h3>
        <div class="about-widget">
          <p>FarmGen est la plateforme agricole qui connecte les producteurs locaux aux consommateurs, en promouvant une agriculture durable et innovante au Cameroun.</p>
          <p>Total d'articles: <strong>{{ total_articles }}</strong></p>
          <div class="social-links">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
      </div>

      <!-- Categories Widget -->
      <div class="sidebar-widget fade-in delay-1">
        <h3>Types de contenu</h3>
        <ul class="categories-list">
          <li>
            <a href="?type=article">
              Articles <span class="category-count">{{ count_articles }}</span>
            </a>
          </li>

          <li>
            <a href="?type=affiche">
              Affiches <span class="category-count">{{ count_affiches }}</span>
            </a>
          </li>

          <li>
            <a href="?type=podcast">
              Podcasts <span class="category-count">{{ count_podcasts }}</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Recent Articles Widget -->
      <div class="sidebar-widget fade-in delay-2">
        <h3>Articles récents</h3>
        <ul class="recent-posts-list">
          {% for article in recent_articles %}
          <li class="recent-post">
            <div class="recent-post-image">
              {% if article.image %}
              <img src="{{ article.image.url }}" alt="{{ article.titre }}">
              {% else %}
              <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" alt="{{ article.titre }}">
              {% endif %}
            </div>
            <div class="recent-post-content">
              <h4><a href="{% url 'article_detail' article.id %}">{{ article.titre|truncatechars:40 }}</a></h4>
              <div class="recent-post-date">
                <i class="far fa-calendar"></i>
                <span>{{ article.date_publication|date:"d M Y" }}</span>
              </div>
            </div>
          </li>
          {% empty %}
          <li>Aucun article récent</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Popular Shops Widget -->
      <div class="sidebar-widget fade-in delay-3">
        <h3>Boutiques populaires</h3>
        <ul class="categories-list">
          {% for shop in popular_shops %}
          <li>
            <a href="?shop={{ shop.id }}">
              {{ shop.title|truncatechars:20 }}
              <span class="category-count">{{ shop.favorite_count }} ♥</span>
            </a>
          </li>
          {% empty %}
          <li>Aucune boutique populaire</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Newsletter Widget -->
      <div class="sidebar-widget fade-in" id="newsletter">
        <h3>Newsletter</h3>
        <p style="color:#000;">Abonnez-vous pour recevoir nos derniers conseils agricoles et actualités.</p>
        <form class="newsletter-form" id="newsletter-form">
          {% csrf_token %}
          <input type="email" name="email" placeholder="Votre adresse email" required>
          <button type="submit">S'abonner</button>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- CTA Section -->
<section class="blog-cta">
  <div class="blog-cta-container">
    <h2 class="fade-in">Prêt à développer votre activité agricole ?</h2>
    <p class="fade-in">Rejoignez FarmGen aujourd'hui et accédez à tous nos outils pour vendre vos produits et développer votre réseau de clients.</p>
    <div class="cta-buttons fade-in">
      {% if user.is_authenticated and user.is_seller %}
      <a href="{% url 'seller_blog' %}" class="btn-light">Publier un article</a>
      {% else %}
      <a href="{% url 'dashboard' %}" class="btn-light">Devenir vendeur</a>
      {% endif %}
      <a href="{% url 'marketplace' %}" class="btn-outline-light">Découvrir le marché</a>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Animation on scroll
    const observerOptions = {
      threshold: 0.1,
      rootMargin: "0px 0px -50px 0px",
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        }
      });
    }, observerOptions);

    document.querySelectorAll(".fade-in").forEach((el) => {
      observer.observe(el);
    });

    // Filter functionality
    const shopFilter = document.getElementById('shop-filter');
    const typeFilter = document.getElementById('type-filter');
    const sortFilter = document.getElementById('sort-filter');
    const clearFiltersBtn = document.getElementById('clear-filters');
    const loadingSpinner = document.getElementById('loading-spinner');
    const postCards = document.querySelectorAll('.post-card');

    // Build URL with filters
    function buildFilterUrl() {
      const params = new URLSearchParams();
      
      if (shopFilter.value !== 'all') {
        params.append('shop', shopFilter.value);
      }
      
      if (typeFilter.value !== 'all') {
        params.append('type', typeFilter.value);
      }
      
      if (sortFilter.value !== 'recent') {
        params.append('sort', sortFilter.value);
      }
      
      const queryString = params.toString();
      return queryString ? `?${queryString}` : '';
    }

    // Apply filters
    function applyFilters() {
      const url = buildFilterUrl();
      loadingSpinner.classList.add('active');
      
      // AJAX request for filtered content
      fetch(`{% url 'blog' %}${url}`, {
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => response.text())
      .then(html => {
        // Parse the response and update content
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Update posts container
        const newPostsContainer = doc.getElementById('posts-container');
        if (newPostsContainer) {
          document.getElementById('posts-container').innerHTML = newPostsContainer.innerHTML;
        }
        
        // Update pagination
        const newPagination = doc.querySelector('.pagination');
        const currentPagination = document.querySelector('.pagination');
        if (newPagination && currentPagination) {
          currentPagination.innerHTML = newPagination.innerHTML;
        }
        
        // Re-initialize animations
        document.querySelectorAll(".fade-in").forEach((el) => {
          observer.observe(el);
        });
        
        // Update URL without page reload
        window.history.pushState({}, '', `{% url 'blog' %}${url}`);
        
        loadingSpinner.classList.remove('active');
      })
      .catch(error => {
        console.error('Error:', error);
        loadingSpinner.classList.remove('active');
      });
    }

    // Event listeners for filters
    shopFilter.addEventListener('change', applyFilters);
    typeFilter.addEventListener('change', applyFilters);
    sortFilter.addEventListener('change', applyFilters);

    // Clear filters
    clearFiltersBtn.addEventListener('click', function() {
      shopFilter.value = 'all';
      typeFilter.value = 'all';
      sortFilter.value = 'recent';
      applyFilters();
    });

    // Newsletter form handling
    const newsletterForm = document.getElementById('newsletter-form');
    if (newsletterForm) {
      newsletterForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        
        fetch('#', {
          method: 'POST',
          body: formData,
          headers: {
            'X-CSRFToken': '{{ csrf_token }}'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            this.innerHTML = '<p style="color: var(--primary-green); text-align: center; margin: 0; font-weight: 600;">Merci pour votre inscription !</p>';
          } else {
            alert('Erreur: ' + (data.error || 'Une erreur est survenue'));
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Erreur de connexion');
        });
      });
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Handle browser back/forward buttons
    window.addEventListener('popstate', function() {
      applyFilters();
    });
  });
</script>
{% endblock %}