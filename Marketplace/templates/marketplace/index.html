{% extends 'account/layout/base_dashboard.html' %}
{% load static %}

{% block content %}
<style>
    /* Styles existants conservés et étendus */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: var(--radius);
        padding: 25px;
        box-shadow: var(--shadow);
        text-align: center;
        border-left: 4px solid var(--primary);
        transition: var(--transition);
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(34, 139, 34, 0.2);
    }

    .stat-card.primary { border-left-color: var(--primary); }
    .stat-card.success { border-left-color: var(--success); }
    .stat-card.warning { border-left-color: var(--warning); }
    .stat-card.danger { border-left-color: var(--danger); }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        font-size: 1.5rem;
    }

    .stat-card.primary .stat-icon { background: rgba(34, 139, 34, 0.1); color: var(--primary); }
    .stat-card.success .stat-icon { background: rgba(40, 167, 69, 0.1); color: var(--success); }
    .stat-card.warning .stat-icon { background: rgba(255, 193, 7, 0.1); color: var(--warning); }
    .stat-card.danger .stat-icon { background: rgba(220, 53, 69, 0.1); color: var(--danger); }

    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        margin: 0 0 5px;
    }

    .stat-label {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin: 0;
    }

    .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }

    .quick-action {
        background: white;
        border-radius: var(--radius);
        padding: 20px;
        text-align: center;
        box-shadow: var(--shadow);
        cursor: pointer;
        transition: var(--transition);
        border: 2px solid transparent;
    }

    .quick-action:hover {
        border-color: var(--primary);
        transform: translateY(-3px);
    }

    .quick-action i {
        font-size: 2rem;
        color: var(--primary);
        margin-bottom: 10px;
    }

    .quick-action h4 {
        margin: 0 0 5px;
        color: var(--dark);
    }

    .quick-action p {
        margin: 0;
        color: #7f8c8d;
        font-size: 0.85rem;
    }

    .table-container {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        overflow: hidden;
    }

    .table-header {
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .table-title {
        margin: 0;
        color: var(--primary);
        font-size: 1.2rem;
    }

    .table-actions {
        display: flex;
        gap: 10px;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th,
    .table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    .table th {
        background: var(--light);
        font-weight: 600;
        color: var(--dark);
    }

    .table tbody tr:hover {
        background: rgba(34, 139, 34, 0.02);
    }

    .status-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .status-active { background: rgba(40, 167, 69, 0.1); color: var(--success); }
    .status-inactive { background: rgba(108, 117, 125, 0.1); color: #6c757d; }
    .status-low-stock { background: rgba(255, 193, 7, 0.1); color: var(--warning); }
    .status-out-of-stock { background: rgba(220, 53, 69, 0.1); color: var(--danger); }

    .action-buttons {
        display: flex;
        gap: 5px;
    }

    .btn-sm {
        padding: 6px 12px;
        font-size: 0.8rem;
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #7f8c8d;
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    /* Modal styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
    }

    .modal-overlay.show {
        display: flex;
    }

    .modal {
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        max-width: 600px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
        from { opacity: 0; transform: translateY(-50px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        margin: 0;
        color: var(--primary);
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #7f8c8d;
        transition: var(--transition);
    }

    .modal-close:hover {
        color: var(--danger);
    }

    .modal-body {
        padding: 20px;
    }

    .modal-footer {
        padding: 20px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    /* Form styles améliorés */
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
    }

    .image-upload {
        border: 2px dashed #ddd;
        border-radius: var(--radius);
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
    }

    .image-upload:hover {
        border-color: var(--primary);
    }

    .image-upload i {
        font-size: 2rem;
        color: #7f8c8d;
        margin-bottom: 10px;
    }

    .image-preview {
        max-width: 200px;
        max-height: 200px;
        border-radius: var(--radius);
        margin: 10px auto;
        display: none;
    }

    .search-box {
        position: relative;
        max-width: 300px;
    }

    .search-box input {
        padding-left: 40px;
    }

    .search-box i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #7f8c8d;
    }
</style>

<!-- Gradient background circles -->
<div class="gradient-circles">
    <div class="gradient-circle circle-1"></div>
    <div class="gradient-circle circle-2"></div>
</div>

<!-- Main Content -->
<main>
    <!-- Dashboard Boutique -->
    <div class="profile-container animate__animated animate__fadeIn">
        <div class="section-header">
            <h3 class="section-title"><i class="fas fa-store"></i> Tableau de Bord - {{ shop.title }}</h3>
        </div>

        <!-- Statistiques -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="stat-icon">
                    <i class="fas fa-cube"></i>
                </div>
                <div class="stat-number">{{ total_products }}</div>
                <div class="stat-label">Produits Actifs</div>
            </div>
            <div class="stat-card success">
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-number">{{ total_orders }}</div>
                <div class="stat-label">Commandes</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-icon">
                    <i class="fas fa-eye"></i>
                </div>
                <div class="stat-number">{{ total_views }}</div>
                <div class="stat-label">Vues Boutique</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-number">{{ low_stock_products }}</div>
                <div class="stat-label">Stock Faible</div>
            </div>
        </div>

        <!-- Actions Rapides -->
        <div class="quick-actions">
            <div class="quick-action" onclick="openModal('addProductModal')">
                <i class="fas fa-plus-circle"></i>
                <h4>Nouveau Produit</h4>
                <p>Ajouter un produit à votre boutique</p>
            </div>
            <div class="quick-action" onclick="openModal('addCategoryModal')">
                <i class="fas fa-tags"></i>
                <h4>Nouvelle Catégorie</h4>
                <p>Créer une nouvelle catégorie</p>
            </div>
            <div class="quick-action" onclick="window.location.href='#'">
                <i class="fas fa-clipboard-list"></i>
                <h4>Voir Commandes</h4>
                <p>Gérer les commandes clients</p>
            </div>
            <div class="quick-action" onclick="openModal('editShopModal')">
                <i class="fas fa-edit"></i>
                <h4>Modifier Boutique</h4>
                <p>Mettre à jour les informations</p>
            </div>
        </div>

        <!-- Onglets de Gestion -->
        <div class="tabs-container">
            <div class="tabs">
                <div class="tab active" data-tab="products">Produits ({{ products.count }})</div>
                <div class="tab" data-tab="categories">Catégories ({{ categories.count }})</div>
                <div class="tab" data-tab="analytics">Analytics</div>
            </div>
        </div>

        <!-- Contenu des onglets -->
        <div class="tab-content active" id="products">
            <div class="table-container">
                <div class="table-header">
                    <h4 class="table-title">Liste des Produits</h4>
                    <div class="table-actions">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="productSearch" placeholder="Rechercher un produit...">
                        </div>
                        <button class="btn btn-primary" onclick="openModal('addProductModal')">
                            <i class="fas fa-plus"></i> Nouveau Produit
                        </button>
                    </div>
                </div>
                
                {% if products %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Nom</th>
                                <th>Catégorie</th>
                                <th>Prix</th>
                                <th>Stock</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in products %}
                            <tr>
                                <td>
                                    {% if product.images.first %}
                                    <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                                    {% else %}
                                    <div style="width: 50px; height: 50px; background: #f8f9fa; border-radius: 5px; display: flex; align-items: center; justify-content: center; color: #6c757d;">
                                        <i class="fas fa-image"></i>
                                    </div>
                                    {% endif %}
                                </td>
                                <td>
                                    <strong>{{ product.name }}</strong>
                                    <br>
                                    <small class="text-muted">{{ product.description|truncatewords:5 }}</small>
                                </td>
                                <td>{{ product.category.name|default:"Non catégorisé" }}</td>
                                <td>
                                    <strong>{{ product.price }} FCFA</strong>
                                    {% if product.old_price %}
                                    <br>
                                    <small class="text-muted text-decoration-line-through">{{ product.old_price }} FCFA</small>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ product.quantity }}
                                    {% if product.quantity <= 5 %}
                                    <br>
                                    <small class="text-warning"><i class="fas fa-exclamation-triangle"></i> Stock faible</small>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if product.quantity > 0 %}
                                    <span class="status-badge status-active">Actif</span>
                                    {% else %}
                                    <span class="status-badge status-out-of-stock">Rupture</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-primary" onclick="editProduct({{ product.id }})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="duplicateProduct({{ product.id }})">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteProduct({{ product.id }})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-cube"></i>
                    <h4>Aucun produit</h4>
                    <p>Commencez par ajouter votre premier produit à la boutique</p>
                    <button class="btn btn-primary" onclick="openModal('addProductModal')">
                        <i class="fas fa-plus"></i> Ajouter un produit
                    </button>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="tab-content" id="categories">
            <div class="table-container">
                <div class="table-header">
                    <h4 class="table-title">Catégories de Produits</h4>
                    <button class="btn btn-primary" onclick="openModal('addCategoryModal')">
                        <i class="fas fa-plus"></i> Nouvelle Catégorie
                    </button>
                </div>
                
                {% if categories %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Description</th>
                                <th>Nombre de produits</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category in categories %}
                            <tr>
                                <td>
                                    <strong>{{ category.name }}</strong>
                                </td>
                                <td>{{ category.description|default:"Aucune description"|truncatewords:10 }}</td>
                                <td>
                                    <span class="badge bg-primary">{{ category.products.count }}</span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-primary" onclick="editCategory({{ category.id }})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteCategory({{ category.id }})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-tags"></i>
                    <h4>Aucune catégorie</h4>
                    <p>Créez des catégories pour organiser vos produits</p>
                    <button class="btn btn-primary" onclick="openModal('addCategoryModal')">
                        <i class="fas fa-plus"></i> Créer une catégorie
                    </button>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="tab-content" id="analytics">
            <div class="info-card">
                <div class="info-header">
                    <h4 class="info-title"><i class="fas fa-chart-bar"></i> Analytics de la Boutique</h4>
                </div>
                <div class="info-content">
                    <div class="info-item">
                        <div class="info-label">Produits les plus vus</div>
                        <div class="info-value">
                            {% for product in popular_products %}
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>{{ product.name }}</span>
                                <span class="text-primary">{{ product.views_count }} vues</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Performance des catégories</div>
                        <div class="info-value">
                            {% for category in category_stats %}
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>{{ category.name }}</span>
                                <span class="text-success">{{ category.product_count }} produits</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Modals -->
<!-- Modal Ajouter/Modifier Produit -->
<div class="modal-overlay" id="addProductModal">
    <div class="modal">
        <div class="modal-header">
            <h4 class="modal-title" id="productModalTitle">Ajouter un Produit</h4>
            <button class="modal-close" onclick="closeModal('addProductModal')">&times;</button>
        </div>
        <form id="productForm" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="product_id" id="productId">
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Nom du produit *</label>
                        <input type="text" name="name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Catégorie *</label>
                        <select name="category" class="form-control" required>
                            <option value="">Sélectionnez une catégorie</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Prix (FCFA) *</label>
                        <input type="number" name="price" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantité en stock *</label>
                        <input type="number" name="quantity" class="form-control" min="0" required>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-control" rows="4" placeholder="Décrivez votre produit..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Images du produit</label>
                    <div class="image-upload" onclick="document.getElementById('productImages').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Cliquez pour ajouter des images</p>
                        <small>Formats supportés: JPG, PNG, WEBP (Max 5MB)</small>
                    </div>
                    <input type="file" id="productImages" name="images" multiple accept="image/*" style="display: none;" onchange="previewImages(this)">
                    <div id="imagePreview" class="d-flex flex-wrap gap-2 mt-2"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addProductModal')">Annuler</button>
                <button type="submit" class="btn btn-primary">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Ajouter/Modifier Catégorie -->
<div class="modal-overlay" id="addCategoryModal">
    <div class="modal">
        <div class="modal-header">
            <h4 class="modal-title" id="categoryModalTitle">Ajouter une Catégorie</h4>
            <button class="modal-close" onclick="closeModal('addCategoryModal')">&times;</button>
        </div>
        <form id="categoryForm" method="post">
            {% csrf_token %}
            <input type="hidden" name="category_id" id="categoryId">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nom de la catégorie *</label>
                    <input type="text" name="name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-control" rows="3" placeholder="Décrivez cette catégorie..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addCategoryModal')">Annuler</button>
                <button type="submit" class="btn btn-primary">Enregistrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Modifier Boutique -->
<div class="modal-overlay" id="editShopModal">
    <div class="modal">
        <div class="modal-header">
            <h4 class="modal-title">Modifier la Boutique</h4>
            <button class="modal-close" onclick="closeModal('editShopModal')">&times;</button>
        </div>
        <form method="post" action="{% url 'update_shop' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nom de la boutique *</label>
                    <input type="text" name="title" class="form-control" value="{{ shop.title }}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-control" rows="4">{{ shop.description }}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Localisation *</label>
                    <input type="text" name="localisation" class="form-control" value="{{ shop.localisation }}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Type de boutique</label>
                    <input type="text" name="type_shop" class="form-control" value="{{ shop.type_shop }}">
                </div>
                <div class="form-group">
                    <label class="form-label">Image de couverture</label>
                    <input type="file" name="couverture" class="form-control" accept="image/*">
                    {% if shop.couverture %}
                    <small>Image actuelle: {{ shop.couverture.name }}</small>
                    {% endif %}
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editShopModal')">Annuler</button>
                <button type="submit" class="btn btn-primary">Mettre à jour</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Gestion des modals
    function openModal(modalId) {
        document.getElementById(modalId).classList.add('show');
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('show');
        resetForms();
    }

    function resetForms() {
        document.getElementById('productForm').reset();
        document.getElementById('categoryForm').reset();
        document.getElementById('imagePreview').innerHTML = '';
        document.getElementById('productId').value = '';
        document.getElementById('categoryId').value = '';
        document.getElementById('productModalTitle').textContent = 'Ajouter un Produit';
        document.getElementById('categoryModalTitle').textContent = 'Ajouter une Catégorie';
    }

    // Prévisualisation des images
    function previewImages(input) {
        const preview = document.getElementById('imagePreview');
        preview.innerHTML = '';
        
        if (input.files) {
            Array.from(input.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = '100px';
                    img.style.height = '100px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '5px';
                    img.style.margin = '5px';
                    preview.appendChild(img);
                }
                reader.readAsDataURL(file);
            });
        }
    }

    // Édition de produit
    function editProduct(productId) {
        fetch(`/api/products/${productId}/`)
            .then(response => response.json())
            .then(product => {
                document.getElementById('productId').value = product.id;
                document.getElementById('productModalTitle').textContent = 'Modifier le Produit';
                document.querySelector('input[name="name"]').value = product.name;
                document.querySelector('select[name="category"]').value = product.category_id;
                document.querySelector('input[name="price"]').value = product.price;
                document.querySelector('input[name="quantity"]').value = product.quantity;
                document.querySelector('textarea[name="description"]').value = product.description;
                openModal('addProductModal');
            })
            .catch(error => console.error('Error:', error));
    }

    // Édition de catégorie
    function editCategory(categoryId) {
        fetch(`/api/categories/${categoryId}/`)
            .then(response => response.json())
            .then(category => {
                document.getElementById('categoryId').value = category.id;
                document.getElementById('categoryModalTitle').textContent = 'Modifier la Catégorie';
                document.querySelector('input[name="name"]').value = category.name;
                document.querySelector('textarea[name="description"]').value = category.description;
                openModal('addCategoryModal');
            })
            .catch(error => console.error('Error:', error));
    }

    // Suppression de produit
    function deleteProduct(productId) {
        if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
            fetch(`/api/products/${productId}/delete/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Erreur lors de la suppression');
                }
            });
        }
    }

    // Suppression de catégorie
    function deleteCategory(categoryId) {
        if (confirm('Êtes-vous sûr de vouloir supprimer cette catégorie ? Les produits associés seront décatégorisés.')) {
            fetch(`/api/categories/${categoryId}/delete/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert(data.message || 'Erreur lors de la suppression');
                }
            });
        }
    }

    // Dupliquer produit
    function duplicateProduct(productId) {
        if (confirm('Dupliquer ce produit ?')) {
            fetch(`/api/products/${productId}/duplicate/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Erreur lors de la duplication');
                }
            });
        }
    }

    // Recherche de produits
    document.getElementById('productSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#products tbody tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });

    // Gestion des onglets
    document.addEventListener('DOMContentLoaded', function() {
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(tc => tc.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });
    });
</script>
{% endblock %}